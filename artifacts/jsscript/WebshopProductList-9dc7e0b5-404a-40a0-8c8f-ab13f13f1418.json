{
	"id": "9dc7e0b5-404a-40a0-8c8f-ab13f13f1418",
	"createdAt": "2018-04-24T13:23:54.000Z",
	"createdBy": "morten",
	"globalScripts": [],
	"externalModules": [],
	"entitySets": [
		{
			"id": "61836814-c0b8-4523-95c1-753afe37cc46",
			"selected": true,
			"name": "p9productfeature",
			"contextname": ""
		},
		{
			"id": "81a5f20a-71b1-449a-81da-b6f0557de010",
			"selected": true,
			"name": "p9product",
			"contextname": ""
		},
		{
			"id": "a7b3288c-9dc1-45b5-a7f3-d525daba26e7",
			"selected": true,
			"name": "p9wishlist",
			"contextname": ""
		},
		{
			"id": "18ca3c19-1aef-47af-ab5d-cee87d746676",
			"selected": true,
			"name": "p9stock",
			"contextname": ""
		}
	],
	"apis": [],
	"name": "WebshopProductList",
	"ver": "18.8.20.146",
	"description": "Webshop: Get Product List",
	"content": [
		"==OBJECT STRING==",
		"try {",
		"",
		"    let category = 'spaceship';",
		"    let uname = 'morten';",
		"",
		"    if (req.query) {",
		"        log.info(\"WebshopProductList -> req.query.category: \" + req.query.category);",
		"        category = req.query.category;",
		"    }",
		"    if (req.user) {",
		"        log.info(\"WebshopProductList -> req.user.username: \" + req.user.username);",
		"        uname = req.user.username;",
		"    }",
		"",
		"    let productList = await tables.p9product.find({",
		"        category: category",
		"    });",
		"    log.info(\"WebshopProductList -> productList: \" + JSON.stringify(productList));",
		"    // const wishlist = await tables.p9wishlist.find({",
		"    //     username: uname",
		"    // });",
		"",
		"    log.info(\"WebshopProductList -> category: \" + category);",
		"    log.info(\"WebshopProductList -> uname: \" + uname);",
		"",
		"    let stockArr = await tables.p9stock.find();",
		"    // log.info(\"WebshopProductList -> stockArr: \" + JSON.stringify(stockArr));",
		"",
		"    for (i = 0; i < productList.length; i++) {",
		"",
		"        var product = productList[i];",
		"        let productNo = product.productNo;",
		"        var productStock = 0;",
		"        ",
		"        log.info(\"WebshopProductList -> productNo: \" + productNo);",
		"",
		"        for (j = 0; j < stockArr.length; j++) {",
		"",
		"            var stock = stockArr[j];",
		"            if (product.productNo === stock.productNo) {",
		"                productStock += +stock.quantity;",
		"            }",
		"        }",
		"",
		"        product.stock = productStock;",
		"        product.features = [];",
		"",
		"        const features = await tables.p9productfeature.find({",
		"            productNo: productNo",
		"        });",
		"        log.info(\"WebshopProductList -> features: \" + JSON.stringify(features));",
		"        ",
		"        features.forEach(function(feature) {",
		"            product.features.push({",
		"                feature: feature.featureText",
		"            });",
		"            // log.info(feature.featureText);",
		"        });",
		"        log.info(\"WebshopProductList -> After features.forEach\");",
		"        // let wishlist = await tables.p9wishlist.find({",
		"        //     username: uname,",
		"        //     productNo: productNo",
		"        // });",
		"",
		"        let wishlist = await tables.p9wishlist.find({",
		"            username: uname,",
		"            productNo: productNo",
		"        });",
		"        log.info(\"WebshopProductList -> wishlist: \" + JSON.stringify(wishlist));",
		"        product.favorite = (Array.isArray(wishlist) && wishlist.length > 0) ? true : false;",
		"    }",
		"",
		"    result = productList;",
		"",
		"} catch (e) {",
		"    // result = setStatus(99, e);",
		"    log.info('WebshopProductList: ERROR Getting Products... -> ' + JSON.stringify(e));",
		"}",
		"",
		"// // enable for MultiModel use",
		"// // result = {",
		"// //     result: {",
		"// //         category: productList",
		"// //     }",
		"// // };",
		"",
		"// // End Server Script",
		"complete();"
	],
	"useAsGlobalScript": false,
	"isTypescript": false,
	"transpiledContent": null,
	"lastRunSuccessful": false,
	"jsscriptGroup": "b348e8c2-3ad0-4d52-8334-58f371f58d7c",
	"package": "3b6d7a6b-5bd6-40e8-b5d4-70e4be5c46e0"
}