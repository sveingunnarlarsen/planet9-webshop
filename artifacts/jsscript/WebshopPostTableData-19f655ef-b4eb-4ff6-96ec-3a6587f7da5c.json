{
	"id": "19f655ef-b4eb-4ff6-96ec-3a6587f7da5c",
	"createdAt": "2018-05-01T07:18:44.000Z",
	"createdBy": "morten",
	"globalScripts": [],
	"externalModules": [],
	"entitySets": [
		{
			"id": "61836814-c0b8-4523-95c1-753afe37cc46",
			"selected": true,
			"name": "p9productfeature",
			"contextname": ""
		},
		{
			"id": "52fb9bcb-cc9c-4127-879d-143d5fd99f18",
			"selected": true,
			"name": "p9countries",
			"contextname": ""
		},
		{
			"id": "71c1f043-73d3-4a85-a12f-2fe7fe33eb1b",
			"selected": true,
			"name": "p9productdescription",
			"contextname": ""
		},
		{
			"id": "1e422fda-e5ac-4672-bcbe-319ad104f176",
			"selected": true,
			"name": "p9productcategory",
			"contextname": ""
		},
		{
			"id": "81a5f20a-71b1-449a-81da-b6f0557de010",
			"selected": true,
			"name": "p9product",
			"contextname": ""
		},
		{
			"id": "d2643288-07fc-46fa-a6d7-188ce047883d",
			"selected": true,
			"name": "p9media",
			"contextname": ""
		},
		{
			"id": "349d5378-23ce-4f2d-b364-2c9f71cc5fe6",
			"selected": true,
			"name": "p9warehouse",
			"contextname": ""
		},
		{
			"id": "18ca3c19-1aef-47af-ab5d-cee87d746676",
			"selected": true,
			"name": "p9stock",
			"contextname": ""
		},
		{
			"id": "d64e3997-72de-4aa5-af35-a4af954dca88",
			"selected": true,
			"name": "p9customer",
			"contextname": ""
		}
	],
	"apis": [],
	"name": "WebshopPostTableData",
	"ver": "18.8.20.145",
	"description": "Webshop: Post Table Data",
	"content": [
		"==OBJECT STRING==",
		"let dataApi = req.body;",
		"// log.info('dataApi -> ' + typeof dataApi);",
		"",
		"let tableData = JSON.parse(dataApi.tableData);",
		"// log.info('Tablename        -> ' + dataApi.tableName);",
		"// log.info('Tabledata Array? -> ' + (Array.isArray(tableData)));",
		"// log.info('Tabledata        -> ' + tableData);",
		"",
		"// for (var key in tables) {",
		"//     log.info('key stringify -> ' + JSON.stringify(key));",
		"// }",
		"",
		"// log.info((Array.isArray(p9table)) ? \"array\" : typeof p9table);",
		"",
		"let discardedRecords = 0;",
		"",
		"try {",
		"",
		"    for (i = 0; i < tableData.length; i++) {",
		"",
		"        var tableObject = tableData[i];",
		"        // log.info('tableObject -> ' + JSON.stringify(tableObject));",
		"",
		"        const existingTableEntry = await tables[dataApi.tableName].find(tableObject);",
		"        // log.info('existingTableEntry -> ' + JSON.stringify(existingTableEntry));",
		"",
		"        if (Array.isArray(existingTableEntry) && existingTableEntry.length > 0) {",
		"            ++discardedRecords;",
		"        } else {",
		"",
		"            tableObject.id = uuid();",
		"            tableObject.createdBy = req.user.username;",
		"            tableObject.changedBy = req.user.username;",
		"            // log.info('tableObject -> ' + JSON.stringify(tableObject));",
		"",
		"            await tables[dataApi.tableName].create(tableObject);",
		"        }",
		"    }",
		"    let updatedRecords = tableData.length - discardedRecords;",
		"    let statusText = \"Table \" + dataApi.tableName + \" updated. \" + updatedRecords + '/' + tableData.length + ' records added.';",
		"    result = setStatus(0, statusText);",
		"",
		"} catch (e) {",
		"    ",
		"    log.info(e);",
		"    ",
		"    var errorText = '';",
		"    if (e.cause) {",
		"        errorText = e.code + ': ' + e.details;",
		"    }",
		"    else{",
		"        errorText = e;",
		"    }",
		"    result = setStatus(99, errorText);",
		"}",
		"",
		"complete();",
		"",
		"function setStatus(code, text) {",
		"    return {",
		"        result: {",
		"            statusCode: code,",
		"            statusText: text",
		"        }",
		"    };",
		"}",
		"// use this snippet to show object properties",
		"// for (var key in obj) {",
		"//     log.info( (Array.isArray(key)) ? \"array\" : typeof key);",
		"//     log.info(key.toString());",
		"//     log.info(JSON.stringify(key));",
		"// }",
		"",
		""
	],
	"useAsGlobalScript": false,
	"isTypescript": false,
	"transpiledContent": null,
	"lastRunSuccessful": false,
	"jsscriptGroup": "b348e8c2-3ad0-4d52-8334-58f371f58d7c",
	"package": "3b6d7a6b-5bd6-40e8-b5d4-70e4be5c46e0"
}